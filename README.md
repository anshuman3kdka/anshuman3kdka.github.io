# Site Notes

This repository hosts a static writing portfolio with a generated search index.

## Search indexing

Search data is generated by `scripts/generate-search-index.mjs`.

- The script scans Markdown and HTML content files in the repo.
- It extracts `title`, `category`, `url`, and plain-text `content` snippets.
- It writes output to a single canonical file consumed by the frontend:
  - `search.json`

Run it with:

```bash
npm run generate:search-index
```

`npm run build` currently runs the same indexing step.

## Copy-protection behavior

The frontend intentionally does **not** include copy-protection logic right now.

- `assets/site.js` does not register `initCopyProtection` handlers.
- There is no `window.initCopyProtection` export.
- `data-copy-protected` / `data-paywalled-content` attributes are currently unused by the site scripts.

If copy protection is reintroduced later, wire it explicitly in `initPage()` and document which templates opt in.

## Automatic indexing on content changes

A GitHub Actions workflow (`.github/workflows/auto-update-search-index.yml`) now runs on pushes that modify content files.
It regenerates `search.json` and commits any updates automatically.

## Pages CMS media uploads

This repo is configured so Pages CMS can upload images to `assets/uploads/`.

- In the editor, use image fields such as `Featured Image (optional)` and `Project Image (optional)`.
- You can also add inline images inside Markdown content using the image button.
- Uploaded files are stored in `assets/uploads/` and referenced with `/assets/uploads/<filename>`.

If image uploads do not appear, verify Pages CMS has write access to the repository branch.

## Image optimization + publishing checklist

Use this quick process before publishing posts with images:

1. **Upload smaller images**
   - Compress images before upload using free tools like Squoosh or TinyPNG.
   - Target roughly **150–250 KB** for regular content images when possible.
2. **Cloudflare optimization settings**
   - Enable **Polish** if your Cloudflare plan includes it (if unavailable, skip it).
   - Enable **Auto Minify** for **CSS, JS, and HTML** under **Speed → Optimization**.
3. **Simple pre-publish checks**
   - Avoid uploading huge originals directly from phone cameras.
   - Prefer modern formats such as **WebP** when your CMS supports them.

## Additional Pages CMS configuration

The CMS now includes broad editing coverage for content + site chrome:

1. **SEO fields:** collections and pages include optional `description` fields for metadata-friendly summaries.
2. **Single-page editing:** all major page files are editable directly (`index.md`, `about`, `contact`, `resume`, `creative`, and listing pages).
3. **Site settings panel:** `_data/site.yml` powers header title/link, nav links, search placeholder, footer heading/note, contact info, and social links.
4. **About portrait controls:** about photo URL, alt text, and caption are editable through CMS and rendered directly on the page.
5. **Home page cards:** `_data/home_cards.yml` provides repeatable cards with type, title, description, link text, and link URL fields.
6. **Featured cards section copy:** site settings now include editable eyebrow, title, and subtitle text for the homepage featured cards area.

These are wired into the live layout:

- `<meta name="description">` uses each page's `description` when provided.
- Header brand text/link and navigation read from `_data/site.yml`.
- Footer heading/text/social links read from `_data/site.yml`.
- Homepage hero title/tagline read from `_data/site.yml`.

## Cloudflare caching checklist

After deploying content updates, keep Cloudflare caching configured for static asset performance while avoiding stale HTML.

1. **Caching → Configuration**
   - Set **Browser Cache TTL** to at least **1 month** for static file reuse.
   - Keep **Always Online** enabled.

2. **Rules → Cache Rules**
   - Add rules for static paths and extensions such as:
     - `/assets/*`
     - `*.css`, `*.js`, `*.jpg`, `*.png`, `*.webp`, `*.svg`, `*.json`
   - Set **Cache eligibility** to **Eligible for cache**.
   - Set **Edge TTL** to a long duration (for example, **1 month**).

3. **HTML caching**
   - Keep HTML caching conservative unless you have a clear cache-purge workflow.
   - If you cache HTML aggressively, purge cache after publishing updates.

4. **Post-publish purge**
   - Use **Caching → Purge Cache** after publishing changes.
   - Do selective purges where possible; use full purge when needed.

## Editorial workflow: monthly analytics review

Use this simple routine once per month to keep analytics and editorial planning up to date.

1. **Collect analytics data**
   - Open your analytics dashboard (for example, Plausible).
   - Record:
     - top 3 posts/pages by views,
     - site-wide average time on page,
     - top on-site search terms.
2. **Update the Insights page**
   - Edit `insights/index.md`.
   - Replace placeholder values in:
     - **Top posts this month**,
     - **Average time on page**,
     - **Search terms readers used**,
     - **Last updated** date.
3. **Editorial decisions**
   - Identify one underperforming page to improve (title, intro, internal links).
   - Identify one high-performing topic to expand with a follow-up post.
4. **Publish + verify**
   - Commit your changes.
   - Deploy the site.
   - Open `/insights/` to confirm the update is visible.

### Analytics script configuration

Analytics loading is controlled via `_data/site.yml` under the `analytics` key:

- `enabled`: `true` or `false`
- `provider`: currently `plausible`
- `domain`: your tracked domain
- `script_src`: analytics script URL

Set `enabled: true` only when you are ready to collect real traffic data.

> The Insights page is intentionally not added to the main nav, so it stays semi-private unless someone has the direct URL.
